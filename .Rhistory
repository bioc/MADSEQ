quantile(chrX$DP,seq(0,1,0.01))
chrX_f = chrX[chrX$DP<250,]
plot(chrX_f$start,chrX_f$Alt_D/chrX_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chrX")
chrX_f = chrX[chrX$Alt_D>25,]
plot(chrX_f$start,chrX_f$Alt_D/chrX_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chrX")
chrX_f[order(chrX_f$Alt_D/chrX_f$DP,decreasing = F)[1:20],]
abline(v=118605114,col="red",lwd=0.5)
abline(v=117605114,col="red",lwd=0.5)
abline(v=119605114,col="red",lwd=0.5)
chrX_f = chrX[!(chrX$start>117605114&chrX$start<119605114),]
plot(chrX_f$start,chrX_f$Alt_D/chrX_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chrX")
N0_f = N0_f[!(N0_f$seqnames=="chrX"&N0_f$start>117605114&N0_f$start<119605114),]
par(mfrow=c(3,1))
for (i in 1:24){
chr = paste("chr",i,sep="")
if (i==23) chr="chrX"
if (i==24) chr="chrY"
tmp = N0_f[N0_f$seqnames==chr,]
plot(tmp$start,tmp$Alt_D/tmp$DP,ylim=c(0,1),pch=20,cex=0.6,main=chr)
}
N75 = read.table("N75/N75.snp.vcf.gz_filtered_heterozygous.txt",sep="\t",header=T)
N75_f = N75[N75$DP>quantile(N75$DP,0.1)&N75$DP<quantile(N75$DP,0.9)&N75$Alt_D>20&N75$Ref_D>20&N75$FILTER==".",]
N75_f = N75_f[!((N75_f$seqnames=="chr14"&N75_f$start>106000000)|(N75_f$seqnames=="chr14"&N75_f$start<21679000)),]
N75_f = N75_f[!(N75_f$seqnames=="chr17"&N75_f$start>20321332&N75_f$start<22319716),]
N75_f = N75_f[!(N75_f$seqnames=="chr12"&N75_f$start>11004000&N75_f$start<11314500),]
N75_f = N75_f[!(N75_f$seqnames=="chr1"&N75_f$start>142187147&N75_f$start<153187147)&!(N75_f$seqnames=="chr1"&N75_f$start>247436912)
&!(N75_f$seqnames=="chr1"&N75_f$start>15503672&N75_f$start<18503672)
&!(N75_f$seqnames=="chr1"&N75_f$start>11856111&N75_f$start<13856111)
&!(N75_f$seqnames=="chr1"&N75_f$start<17746),]
N75_f = N75_f[!(N75_f$seqnames=="chr9"&N75_f$start>65457278&N75_f$start<69457278),]
N75_f = N75_f[!(N75_f$seqnames=="chr16"&N75_f$start>31870664&N75_f$start<39870664),]
N75_f = N75_f[!(N75_f$seqnames=="chr7"&N75_f$start>141099533&N75_f$start<144099533)
&!(N75_f$seqnames=="chr7"&N75_f$start>100050343&N75_f$start<101050343),]
N75_f = N75_f[!(N75_f$seqnames=="chr3"&N75_f$start>194395334),]
N75_f = N75_f[!(N75_f$seqnames=="chr2"&N75_f$start>130044787&N75_f$start<134044787)
&!(N75_f$seqnames=="chr2"&N75_f$start>90259734&N75_f$start<99259734),]
N75_f = N75_f[!(N75_f$seqnames=="chr22"&N75_f$start<26000000&N75_f$Alt_D<50),]
N75_f = N75_f[!(N75_f$seqnames=="chr15"&N75_f$start<40000000&N75_f$DP>200)
&!(N75_f$seqnames=="chr15"&N75_f$start>102006728)
&!(N75_f$seqnames=="chr15"&N75_f$start<40000000&N75_f$Alt_D<50),]
N75_f = N75_f[!(N75_f$seqnames=="chr11"&N75_f$start>47387668&N75_f$start<57387668),]
N75_f = N75_f[!(N75_f$seqnames=="chr17"&N75_f$DP>200),]
N75_f = N75_f[!(N75_f$seqnames=="chrX"&N75_f$start>117605114&N75_f$start<119605114),]
for (i in 1:24){
chr = paste("chr",i,sep="")
if (i==23) chr="chrX"
if (i==24) chr="chrY"
tmp = N75_f[N75_f$seqnames==chr,]
plot(tmp$start,tmp$Alt_D/tmp$DP,ylim=c(0,1),pch=20,cex=0.6,main=chr)
}
quantile(N0$Alt_D,seq(0,1,0.01))
quantile(N75$Alt_D,seq(0,1,0.01))
quantile(N90$Alt_D,seq(0,1,0.01))
quantile(N90$DP,seq(0,1,0.01))
N90 = read.table("N90/N90.snp.vcf.gz_filtered_heterozygous.txt",sep="\t",header=T)
N90_f = N90[N90$DP>quantile(N90$DP,0.1)&N90$DP<quantile(N90$DP,0.9)&N90$Alt_D>20&N90$Ref_D>20&N90$FILTER==".",]
N90_f = N90_f[!((N90_f$seqnames=="chr14"&N90_f$start>106000000)|(N90_f$seqnames=="chr14"&N90_f$start<21679000)),]
N90_f = N90_f[!(N90_f$seqnames=="chr17"&N90_f$start>20321332&N90_f$start<22319716),]
N90_f = N90_f[!(N90_f$seqnames=="chr12"&N90_f$start>11004000&N90_f$start<11314500),]
N90_f = N90_f[!(N90_f$seqnames=="chr1"&N90_f$start>142187147&N90_f$start<153187147)&!(N90_f$seqnames=="chr1"&N90_f$start>247436912)
&!(N90_f$seqnames=="chr1"&N90_f$start>15503672&N90_f$start<18503672)
&!(N90_f$seqnames=="chr1"&N90_f$start>11856111&N90_f$start<13856111)
&!(N90_f$seqnames=="chr1"&N90_f$start<17746),]
N90_f = N90_f[!(N90_f$seqnames=="chr9"&N90_f$start>65457278&N90_f$start<69457278),]
N90_f = N90_f[!(N90_f$seqnames=="chr16"&N90_f$start>31870664&N90_f$start<39870664),]
N90_f = N90_f[!(N90_f$seqnames=="chr7"&N90_f$start>141099533&N90_f$start<144099533)
&!(N90_f$seqnames=="chr7"&N90_f$start>100050343&N90_f$start<101050343),]
N90_f = N90_f[!(N90_f$seqnames=="chr3"&N90_f$start>194395334),]
N90_f = N90_f[!(N90_f$seqnames=="chr2"&N90_f$start>130044787&N90_f$start<134044787)
&!(N90_f$seqnames=="chr2"&N90_f$start>90259734&N90_f$start<99259734),]
N90_f = N90_f[!(N90_f$seqnames=="chr22"&N90_f$start<26000000&N90_f$Alt_D<50),]
N90_f = N90_f[!(N90_f$seqnames=="chr15"&N90_f$start<40000000&N90_f$DP>200)
&!(N90_f$seqnames=="chr15"&N90_f$start>102006728)
&!(N90_f$seqnames=="chr15"&N90_f$start<40000000&N90_f$Alt_D<50),]
N90_f = N90_f[!(N90_f$seqnames=="chr11"&N90_f$start>47387668&N90_f$start<57387668),]
N90_f = N90_f[!(N90_f$seqnames=="chr17"&N90_f$DP>200),]
N90_f = N90_f[!(N90_f$seqnames=="chrX"&N90_f$start>117605114&N90_f$start<119605114),]
for (i in 1:24){
chr = paste("chr",i,sep="")
if (i==23) chr="chrX"
if (i==24) chr="chrY"
tmp = N90_f[N90_f$seqnames==chr,]
plot(tmp$start,tmp$Alt_D/tmp$DP,ylim=c(0,1),pch=20,cex=0.6,main=chr)
}
chr13 = N0_f[N0_f$seqnames=="chr13",]
plot(chr13$start,chr13$Alt_D/chr13$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr13")
chr13[order(chr13$Alt_D/chr13$DP,decreasing = F)[1:20],]
abline(v=24670851,col="red",lwd=0.5)
abline(v=26670851,col="red",lwd=0.5)
chr13_f = chr13[!(chr13$start>24670851&chr13$start<26670851),]
plot(chr13_f$start,chr13_f$Alt_D/chr13_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr13")
N0_f = N0_f[!(N0_f$seqnames=="chr13"&N0_f$start>24670851&N0_f$start<26670851),]
N90_f = N90_f[!(N90_f$seqnames=="chr13"&N90_f$start>24670851&N90_f$start<26670851),]
for (i in 1:24){
chr = paste("chr",i,sep="")
if (i==23) chr="chrX"
if (i==24) chr="chrY"
tmp = N90_f[N90_f$seqnames==chr,]
plot(tmp$start,tmp$Alt_D/tmp$DP,ylim=c(0,1),pch=20,cex=0.6,main=chr)
}
N75_f = N75_f[!(N75_f$seqnames=="chr13"&N75_f$start>24670851&N75_f$start<26670851),]
write.table(N0_f,file="N0/N0_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
write.table(N75_f,file="N75/N75_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
write.table(N90_f,file="N90/N90_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
ID="N75"
chr="chr12"
res = runMadSeq(tmp_AAF,tmp_normed,chr,burnin=5000,adapt=3000,nStep=5000,thinSteps=1)
tmp_normed = paste("./normed_depth/",ID,"_cov_normed_depth.txt",sep="")
tmp_AAF = paste("./",ID,"/",ID,"_filtered_heterozygous.txt",sep="")
res = runMadSeq(tmp_AAF,tmp_normed,chr,burnin=5000,adapt=3000,nStep=5000,thinSteps=1)
chr9 = N0_f[N0_f$seqnames=="chr9",]
plot(chr9$start,chr9$Alt_D/chr9$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr9")
chr9[order(chr9$Alt_D/chr9$DP,decreasing = F)[1:20],]
abline(v=32798485 ,col="red",lwd=0.5)
abline(v=34798485 ,col="red",lwd=0.5)
chr9_f = chr9[!(chr9$start>32798485&chr9$start<34798485),]
plot(chr9_f$start,chr9_f$Alt_D/chr9_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr9")
N0_f = N0_f[!(N0_f$seqnames=="chr9"&N0_f$start>32798485&N0_f$start<34798485),]
N75_f = N75_f[!(N75_f$seqnames=="chr9"&N75_f$start>32798485&N75_f$start<34798485),]
N90_f = N90_f[!(N90_f$seqnames=="chr9"&N90_f$start>32798485&N90_f$start<34798485),]
write.table(N0_f,file="N0/N0_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
write.table(N75_f,file="N75/N75_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
write.table(N90_f,file="N90/N90_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
Id="N0"
ID="N0"
chr="chr9"
tmp_normed = paste("./normed_depth/",ID,"_cov_normed_depth.txt",sep="")
tmp_AAF = paste("./",ID,"/",ID,"_filtered_heterozygous.txt",sep="")
res = runMadSeq(tmp_AAF,tmp_normed,chr,burnin=5000,adapt=3000,nStep=5000,thinSteps=1)
summary(res)
chr19_f[108,]
chr9_f[108,]
abline(v=17340747)
chr9_f[398,]
abline(v=78938186)
chr9_f[order(chr9_f$Alt_D/chr9_f$DP,decreasing = F)[1:20],]
chr9_f[order(chr9_f$Alt_D/chr9_f$DP,decreasing = F)[21:30],]
chr9_f[order(chr9_f$Alt_D/chr9_f$DP,decreasing = T)[1:20],]
chr9_f = chr9[!(chr9$start>32798485&chr9$start<34798485)&chr9$Ref_D>25&chr9$Alt_D>25,]
plot(chr9_f$start,chr9_f$Alt_D/chr9_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr9")
chr9_f = chr9[!(chr9$start>32798485&chr9$start<34798485)&chr9$Ref_D>30&chr9$Alt_D>30,]
plot(chr9_f$start,chr9_f$Alt_D/chr9_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr9")
chr9_f[order(chr9_f$Alt_D/chr9_f$DP,decreasing = T)[1:20],]
quantile(chr9$DP,seq(0,1,0.01))
chr9_f = chr9[!(chr9$start>32798485&chr9$start<34798485)&chr9$Ref_D>30&chr9$Alt_D>30&chr9$DP<250,]
plot(chr9_f$start,chr9_f$Alt_D/chr9_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr9")
chr9_f = chr9[!(chr9$start>32798485&chr9$start<34798485)&chr9$DP<250,]
plot(chr9_f$start,chr9_f$Alt_D/chr9_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr9")
chr9_f = chr9[!(chr9$start>32798485&chr9$start<34798485)&chr9$Ref_D>30&chr9$Alt_D>30&chr9$DP<250,]
plot(chr9_f$start,chr9_f$Alt_D/chr9_f$DP,ylim=c(0,1),pch=20,cex=0.6,main="chr9")
chr9_f[order(chr9_f$Alt_D/chr9_f$DP,decreasing = F)[1:20],]
N0_f = N0_f[!(N0_f$seqnames=="chr9"&N0_f$start>32798485&N0_f$start<34798485)
&!(N0_f$seqnames=="chr9"&N0_f$Alt_D<=30&N0_f$Ref_D<=30&N0_f$DP>=250),]
chr="chr9"
tmp = N0_f[N0_f$seqnames==chr,]
plot(tmp$start,tmp$Alt_D/tmp$DP,ylim=c(0,1),pch=20,cex=0.6,main=chr)
N0_f = N0_f[!(N0_f$seqnames=="chr9"&N0_f$start>32798485&N0_f$start<34798485)
&!(N0_f$seqnames=="chr9"&N0_f$Alt_D<=30&N0_f$Ref_D<=30&N0_f$DP>=250),]
N0_f[N0_f$seqnames=="chr9"&N0_f$Alt_D<=30&N0_f$Ref_D<=30&N0_f$DP>=250,]
N0_f = N0_f[!(N0_f$seqnames=="chr9"&N0_f$start>32798485&N0_f$start<34798485)
&!(N0_f$seqnames=="chr9"&N0_f$Alt_D<=30)&!(N0_f$seqnames=="chr9"&N0_f$Ref_D<=30)
&!(N0_f$seqnames=="chr9"&N0_f$DP>=250),]
tmp = N0_f[N0_f$seqnames==chr,]
plot(tmp$start,tmp$Alt_D/tmp$DP,ylim=c(0,1),pch=20,cex=0.6,main=chr)
write.table(N0_f,file="N0/N0_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
tmp_normed = paste("./normed_depth/",ID,"_cov_normed_depth.txt",sep="")
tmp_AAF = paste("./",ID,"/",ID,"_filtered_heterozygous.txt",sep="")
res = runMadSeq(tmp_AAF,tmp_normed,chr,burnin=5000,adapt=3000,nStep=5000,thinSteps=1)
save(res,file=paste("./",ID,"/",ID,"_",chr,".RData",sep=""))
N75_f = N75_f[!(N75_f$seqnames=="chr9"&N75_f$start>32798485&N75_f$start<34798485)
&!(N75_f$seqnames=="chr9"&N75_f$Alt_D<=30)&!(N75_f$seqnames=="chr9"&N75_f$Ref_D<=30)
&!(N75_f$seqnames=="chr9"&N75_f$DP>=250),]
write.table(N75_f,file="N75/N75_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
ID="N75"
tmp_normed = paste("./normed_depth/",ID,"_cov_normed_depth.txt",sep="")
tmp_AAF = paste("./",ID,"/",ID,"_filtered_heterozygous.txt",sep="")
res = runMadSeq(tmp_AAF,tmp_normed,chr,burnin=5000,adapt=3000,nStep=5000,thinSteps=1)
N90_f = N90_f[!(N90_f$seqnames=="chr9"&N90_f$start>32798485&N90_f$start<34798485)
&!(N90_f$seqnames=="chr9"&N90_f$Alt_D<=30)&!(N90_f$seqnames=="chr9"&N90_f$Ref_D<=30)
&!(N90_f$seqnames=="chr9"&N90_f$DP>=250),]
write.table(N90_f,file="N90/N90_filtered_heterozygous.txt",quote = F,row.names = F,col.names = T,sep="\t")
ID="N90"
tmp_normed = paste("./normed_depth/",ID,"_cov_normed_depth.txt",sep="")
tmp_AAF = paste("./",ID,"/",ID,"_filtered_heterozygous.txt",sep="")
res = runMadSeq(tmp_AAF,tmp_normed,chr,burnin=5000,adapt=3000,nStep=5000,thinSteps=1)
save(res,file=paste("./",ID,"/",ID,"_",chr,".RData",sep=""))
setwd("/Volumes/home/ykong/dbGAP/ASD1/bam/phs000482")
ID="SRR546838"
gap = read.table("/Volumes/home/ykong/ref/hg19/hg19_gap.txt",sep="\t",header=F)
head(gap)
g
gap = gap[,c(2,3,4,8)]
names(gap) = c("chr","start","end","type")
gap
gap = gap[nchar(gap$chr)<=5,]
gap = gap[nchar(gap$chr)<=5,]
names(gap) = c("chr","start","end","type")
gap = gap[nchar(gap$chr)<=5,]
options(stringsAsFactors = F)
gap = read.table("/Volumes/home/ykong/ref/hg19/hg19_gap.txt",sep="\t",header=F)
gap = gap[,c(2,3,4,8)]
names(gap) = c("chr","start","end","type")
gap = gap[nchar(gap$chr)<=5,]
gap
head(gap)
tail(gap)
gap_gr = GRanges(seqnames=gap$chr,
ranges=IRanges(start=ifelse(gap$start-1000000>=0,gap$start-1000000,0),end=gap$end+1000000))
library(GenomicRanges)
gap_gr = GRanges(seqnames=gap$chr,
ranges=IRanges(start=ifelse(gap$start-1000000>=0,gap$start-1000000,0),end=gap$end+1000000))
gap_gr
mcols(gap_gr)$type = gap$type
gap_gr
table(seqnames(gap_gr))
seqlevels(gap_gr) =c("chr1","chr2","chr3","chr4","chr5",
"chr6","chr7","chr8","chr9","chr10",
"chr11","chr12","chr13","chr14",
"chr15","chr16","chr17","chr18",
"chr19","chr20","chr21","chr22",
"chrX","chrY")
gap_gr = sort(gap_gr)
gap_gr
saveRDS(gap_gr,file="/Volumes/home/ykong/Aneuploidy/hg19_gap_gr.RDS")
gap_gr2 = gap_gr
?seqlevelsStyle
seqlevelsStyle(gap_gr2) = "NCBI"
gap_gr2
table(gap_gr2$seqnames)
table(seqnames(gap_gr2))
saveRDS(gap_gr2,file="/Volumes/home/ykong/Aneuploidy/hs37d5_gap_gr.RDS")
gap = read.table("/Volumes/home/ykong/ref/hg19/hg19_gap.txt",sep="\t",header=F)
gap = gap[,c(2,3,4,8)]
names(gap) = c("chr","start","end","type")
gap = gap[nchar(gap$chr)<=5,]
gap_gr = GRanges(seqnames=gap$chr,
ranges=IRanges(start=ifelse(gap$start-1000000>=0,gap$start-1000000,0),end=gap$end+1000000))
mcols(gap_gr)$type = gap$type
seqlevels(gap_gr) =c("chr1","chr2","chr3","chr4","chr5",
"chr6","chr7","chr8","chr9","chr10",
"chr11","chr12","chr13","chr14",
"chr15","chr16","chr17","chr18",
"chr19","chr20","chr21","chr22",
"chrX","chrY","ChrM")
gap_gr = sort(gap_gr)
saveRDS(gap_gr,file="/Volumes/home/ykong/Aneuploidy/hg19_gap_gr.RDS")
gap_gr2 = gap_gr
seqlevelsStyle(gap_gr2) = "NCBI"
seqlevels(gap_gr2)
seqlevelsStyle(gap_gr2)[25] = "MT"
seqlevels(gap_gr2)
seqlevels(gap_gr) =c("chr1","chr2","chr3","chr4","chr5",
"chr6","chr7","chr8","chr9","chr10",
"chr11","chr12","chr13","chr14",
"chr15","chr16","chr17","chr18",
"chr19","chr20","chr21","chr22",
"chrX","chrY","chrM")
gap_gr = sort(gap_gr)
saveRDS(gap_gr,file="/Volumes/home/ykong/Aneuploidy/hg19_gap_gr.RDS")
gap_gr2 = gap_gr
seqlevelsStyle(gap_gr2) = "NCBI"
seqlevels(gap_gr2)
saveRDS(gap_gr2,file="/Volumes/home/ykong/Aneuploidy/hs37d5_gap_gr.RDS")
hg38_gap = readRDS("/Volumes/home/ykong/Aneuploidy/hg38_gap_gr.RDS")
seqlevels(hg38_gap)
seqlevels(hg38_gap) = c("chr1","chr2","chr3","chr4","chr5",
"chr6","chr7","chr8","chr9","chr10",
"chr11","chr12","chr13","chr14",
"chr15","chr16","chr17","chr18",
"chr19","chr20","chr21","chr22",
"chrX","chrY","chrM")
saveRDS(hg38_gap,file="/Volumes/home/ykong/Aneuploidy/hg38_gap_gr.RDS")
library("MADSEQ")
prepareHetero()
prepareHetero
options(stringsAsFactors = F)
library("MADSEQ")
library("BSgenome")
library("BSgenome.Hsapiens.1000genomes.hs37d5")
target = "Target_hs37.bed"
setwd("/Volumes/data/Project/Aneuploidy/MADSEQ")
setwd("/Volumes/data/Columbia")
target = "Target_hs37.bed"
ID = c("fetal0190F","fetal0071F","fetal0127","fetal0138","fetal0182F")
bam = paste0(ID,".bam")
target = "Target_hs37.bed"
ID = c("fetal0190F","fetal0071F","fetal0127","fetal0138","fetal0182F")
bam = paste0(ID,".bam")
for (i in 1:5){
print(i)
tmp_ID = ID[i]
tmp_bam = bam[i]
tmp_cov = prepareCoverageGC(target_bed = target,
bam = tmp_bam,
genome_assembly = "BSgenome.Hsapiens.1000genomes.hs37d5")
saveRDS(tmp_cov,file=paste0("cov/",tmp_ID,"_cov_gc.RDS"))
}
?normalizeCoverage
fetal0071F_cov = readRDS("cov/fetal0071F_cov_gc.RDS")
fetal0127_cov = readRDS("cov/fetal0127_cov_gc.RDS")
fetal0138_cov = readRDS("cov/fetal0138_cov_gc.RDS")
fetal0190F_cov = readRDS("cov/fetal0190F_cov_gc.RDS")
fetal0182F_cov = readRDS("cov/fetal0182F_cov_gc.RDS")
#-----------Normalize Coverage-------------
fetal0071F_cov = readRDS("cov/fetal0071F_cov_gc.RDS")
fetal0127_cov = readRDS("cov/fetal0127_cov_gc.RDS")
fetal0138_cov = readRDS("cov/fetal0138_cov_gc.RDS")
fetal0190F_cov = readRDS("cov/fetal0190F_cov_gc.RDS")
fetal0182F_cov = readRDS("cov/fetal0182F_cov_gc.RDS")
pdf(file="coverage_10052017.pdf",width=12,height=9)
normalizeCoverage(fetal0071F_cov,fetal0127_cov,fetal0138_cov,fetal0190F_cov,fetal0182F_cov)
pdf(file="coverage_10052017.pdf",width=12,height=9)
normalizeCoverage(fetal0071F_cov,fetal0127_cov,fetal0138_cov,fetal0190F_cov,fetal0182F_cov)
dev.off()
vcf = paste0(ID,".vcf.gz")
for (tmp_vcf in vcf){
print(tmp_vcf)
prepareHetero(vcffile = tmp_vcf,target_bed = target,genome = "BSgenome.Hsapiens.1000genomes.hs37d5",plot=T)
}
vcf = paste0(ID,".vcf.gz")
pdf(file="Filter_AAF_10052017.pdf",width=8,hegiht=12)
vcf = paste0(ID,".vcf.gz")
pdf(file="Filter_AAF_10052017.pdf",width=8,height = =12)
vcf = paste0(ID,".vcf.gz")
pdf(file="Filter_AAF_10052017.pdf",width=8,height=12)
for (tmp_vcf in vcf){
print(tmp_vcf)
prepareHetero(vcffile = tmp_vcf,target_bed = target,genome = "BSgenome.Hsapiens.1000genomes.hs37d5",plot=T)
}
dev.off()
pdf(file="Filter_AAF_10052017.pdf",width=8,height=12)
for (tmp_vcf in vcf){
print(tmp_vcf)
prepareHetero(vcffile = tmp_vcf,target_bed = target,genome = "BSgenome.Hsapiens.1000genomes.hs37d5",plot=T)
}
vcf = paste0(ID,".filtered.target.recode.vcf.gz")
tmp_vcf = vcf[1]
pdf(file="Filter_AAF_10052017.pdf",width=8,height=12)
prepareHetero(vcffile = tmp_vcf,target_bed = target,genome = "BSgenome.Hsapiens.1000genomes.hs37d5",plot=T)
dev.off()
?prepareHetero
tmp_vcf
tmp_vcf
prepareHetero(vcffile = tmp_vcf,target_bed = target,genome = "BSgenome.Hsapiens.1000genomes.hs37d5",plot=T)
pdf(file="Filter_AAF_10052017.pdf",width=8,height=12)
prepareHetero(vcffile = tmp_vcf,target_bed = target,genome = "BSgenome.Hsapiens.1000genomes.hs37d5",plot=T)
vcf = paste0(ID,".filtered.target.deinfo.recode.vcf.gz")
tmp_vcf[1]
vcf = paste0(ID,".filtered.target.deinfo.recode.vcf.gz")
tmp_vcf = vcf[1]
tmp_vcf
dev.off()
pdf(file="Filter_AAF_10052017.pdf",width=8,height=12)
prepareHetero(vcffile = tmp_vcf,target_bed = target,genome = "BSgenome.Hsapiens.1000genomes.hs37d5",plot=T)
?rpois
data_AA = sapply(1:5000,rpois(50,10))
data_AA = sapply(1:5000,function(x)rpois(50,10))
dim(data_AA)
head(data_AA)
data_AA = t(sapply(1:5000,function(x)rpois(50,10)))
head(data_AA)
data_AFR = t(sapply(1:5000,function(x)rpois(50,3)))
heaD(data_AFR)
head(data_AFR)
data_AFR = t(sapply(1:5000,function(x)rpois(50,3)))
colnames(data_AFR) = paste0("AFR",seq(1:50))
data_CEU = t(sapply(1:5000,function(x)rpois(200,3)))
colnames(data_CEU) = paste0("CEU",seq(1:200))
data_AMR = t(sapply(1:5000,function(x)rpois(30,3)))
colnames(data_AMR) = paste0("AMR",seq(1:30))
data_AS = t(sapply(1:5000,function(x)rpois(20,3)))
colnames(data_AS) = paste0("AS",seq(1:20))
enrich_idx = sample(20,1:5000)
enrich_idx
?sample
enrich_idx = sample(1:5000,20)
enrich_idx
enruch_data = t(sapply(1:20,function(x)rpois(50,10)))
data_AFR[enrich_idx,] = rpois(50,10)
data_AFR[3433:3435,]
data_AFR[enrich_idx,] = rpois(50,rpois(1,8))
data_AFR[3433:3435,]
set.seed(1)
data_AFR = t(sapply(1:5000,function(x)rpois(50,3)))
colnames(data_AFR) = paste0("AFR",seq(1:50))
data_CEU = t(sapply(1:5000,function(x)rpois(200,3)))
colnames(data_CEU) = paste0("CEU",seq(1:200))
data_AMR = t(sapply(1:5000,function(x)rpois(30,3)))
colnames(data_AMR) = paste0("AMR",seq(1:30))
data_AS = t(sapply(1:5000,function(x)rpois(20,3)))
colnames(data_AS) = paste0("AS",seq(1:20))
enrich_idx = sort(sample(1:5000,20))
data_AFR[enrich_idx,] = rpois(50,10)
data = cbind(data_AFR,data_CEU,data_AMR,data_AS)
rownames(data) = paste0("gene",seq(1:5000))
data[1:5,1:5]
setwd("/Volumes/data/Project/General_Script")
saveRDS(data,file="data.RDS")
1/100
a = rpois(10,5)
a
sample(a)
b=sample(a)
table(A)
table(a)
table(b)
data_permute = apply(data,1,sample)
data_permute[1:5,1:5]
data[1:5,1:5]
data = as.data.frame(cbind(data_AFR,data_CEU,data_AMR,data_AS))
rownames(data) = paste0("gene",seq(1:5000))
saveRDS(data,file="data.RDS")
data_permute = apply(data,1,sample)
data_permute[1:5,1:5]
dim(data_permute)
data_permute = t(apply(data,1,sample))
dim(data_permute)
data_permute[1:5,1:5]
colnames(data_permute) = colnames(data)
data[1:5,1:5]
data_permute[1:5,1:5]
table(data[1,])
table(data_permute[1,])
data[1,]
data = cbind(data_AFR,data_CEU,data_AMR,data_AS)
table(data[1,])
table(data_permute[1,])
all.equal(t1,t2)
t1 = table(data[1,])
t2 = table(data_permute[1,])
all.equal(t1,t2)
AFR_mean = NULL
CEU_mean = NULL
AMR_mean = NULL
AS_mean = NULL
tmp_data = t(apply(data,1,sample))
sub_AFR_mean = apply(tmp_data[,1:50],1,mean)
sub_CEU_mean = apply(tmp_data[,51:250],1,mean)
sub_AMR_mean = apply(tmp_data[,251:280],1,mean)
sub_AS_mean = apply(tmp_data[,281:300],1,mean)
sub_AFR_mean
length(sub_AFR_mean)
AFR_mean = NULL
CEU_mean = NULL
AMR_mean = NULL
AS_mean = NULL
AFR_mean = NULL
CEU_mean = NULL
AMR_mean = NULL
AS_mean = NULL
for (i in 1:500){
if(i%%100==0) print(i)
tmp_data = t(apply(data,1,sample))
# here instead of collect the permuated data everytime,
# we will only collect statistical values to save memory
# we will collect median/mean of number of SNVs in that gene
# in each population (or other values you are interested in)
sub_AFR_mean = apply(tmp_data[,1:50],1,mean)
sub_CEU_mean = apply(tmp_data[,51:250],1,mean)
sub_AMR_mean = apply(tmp_data[,251:280],1,mean)
sub_AS_mean = apply(tmp_data[,281:300],1,mean)
AFR_mean = cbind(AFR_mean, sub_AFR_mean)
CEU_mean = cbind(CEU_mean, sub_CEU_mean)
AMR_mean = cbind(AMR_mean, sub_AMR_mean)
AS_mean = cbind(AS_mean,sub_AS_mean)
}
colnames(AFR_mean) = paste0("permute",seq(1:500))
rownames(AFR_mean) = paste0("gene",seq(1:5000))
colnames(CEU_mean) = paste0("permute",seq(1:500))
rownames(CEU_mean) = paste0("gene",seq(1:5000))
colnames(AMR_mean) = paste0("permute",seq(1:500))
rownames(AMR_mean) = paste0("gene",seq(1:5000))
colnames(AS_mean) = paste0("permute",seq(1:500))
rownames(AS_mean) = paste0("gene",seq(1:5000))
head(AFR_mean)
AFR_mean[1:5,1:5]
ob_AFR_mean = apply(data[,1:50],1,mean)
ob_CEU_mean = apply(data[,51:250],1,mean)
ob_AMR_mean = apply(data[,251:280],1,mean)
ob_AS_mean = apply(data[,281:300],1,mean)
p_AFR_enrichment = sapply(1:5000,1,function(x)sum(ob_AFR_mean[x]>mean(AFR_mean[x,])))
p_AFR_enrichment = sapply(1:5000,function(x)sum(ob_AFR_mean[x]>mean(AFR_mean[x,])))
head(p_AFR_enrichment )
head(ob_AFR_mean)
p_AFR_enrichment = sapply(1:5000,function(x)sum(ob_AFR_mean[x]>AFR_mean[x,]))
head(ob_AFR_mean)
head(p_AFR_enrichment )
enrich_idx
p_AFR_enrichment = sapply(1:5000,function(x)sum(ob_AFR_mean[x]<AFR_mean[x,])/500)
head(p_AFR_enrichment)
which(p_AFR_enrichment<0.05)
which(p_AFR_enrichment<1/500)
p_AFR_enrichment = sapply(1:5000,function(x)sum(ob_AFR_mean[x]<AFR_mean[x,])/500)
p_CEU_enrichment = sapply(1:5000,function(x)sum(ob_CEU_mean[x]<CEU_mean[x,])/500)
p_AMR_enrichment = sapply(1:5000,function(x)sum(ob_AMR_mean[x]<AMR_mean[x,])/500)
p_AS_enrichment = sapply(1:5000,function(x)sum(ob_AS_mean[x]<AS_mean[x,])/500)
which(p_AFR_enrichment<1/500)
which(p_CEU_enrichment<1/500)
which(p_AMR_enrichment<1/500)
which(p_AS_enrichment<1/500)
which(p_AFR_enrichment<0)
which(p_AFR_enrichment=0)
which(p_AFR_enrichment==0)
which(p_AFR_enrichment<0)
which(p_CEU_enrichment<0)
which(p_AMR_enrichment<0)
which(p_AFR_enrichment<1/500)
which(p_CEU_enrichment<1/500)
which(p_AMR_enrichment<1/500)
which(p_AS_enrichment<1/500)
enrich_idx
saveRDS(enrich_idx,file="enrich_idx.RDS")
