b4 = 1
p1 = data_median["p[1]"]
p2 = data_median["p[2]"]
p3 = data_median["p[3]"]
p4 = 0.01
m1 = signif(data_median["mu[1]"],2)
m2 = signif(data_median["mu[2]"],2)
m3 = signif(data_median["mu[3]"],2)
y_max = max(c(p1*dbeta(seq(0,1,0.01),a1,b1),
p2*dbeta(seq(0,1,0.01),a2,b2),
p3*dbeta(seq(0,1,0.01),a3,b3),
p4*dbeta(seq(0,1,0.01),a4,b4)))
curve(p1*dbeta(x,a1,b1), col="green4", lwd=2,
xlab="alternative allele frequency", ylab="density",
main="posterior distribution of mixtures (LOH)",
mgp=c(2,1,0), xlim=c(0,1), bty="l", ylim=c(0,1.25*y_max))
curve(p2*dbeta(x,a2,b2),col="green4",lwd=2,add=TRUE)
curve(p3*dbeta(x,a3,b3),col="blue",lwd=2,add=TRUE)
curve(p4*dbeta(x,a4,b4),col="grey4",lwd=2,add=TRUE,lty=2)
text(m1,1.05*max(p1*dbeta(seq(0,1,0.01),a1,b1)),
paste("m1 =",as.character(m1)))
text(m2,1.05*max(p2*dbeta(seq(0,1,0.01),a2,b2)),
paste("m2 =",as.character(m2)))
text(m3,1.25*max(p3*dbeta(seq(0,1,0.01),a3,b3)),
paste("m3 =",as.character(m3)))
}
# if not all of the above, then plot two mixtures
else{
a1 = data_median["mu[1]"]*data_median["kappa"]
b1 = (1-data_median["mu[1]"])*data_median["kappa"]
a2 = data_median["mu[2]"]*data_median["kappa"]
b2 = (1-data_median["mu[2]"])*data_median["kappa"]
a3 = 1
b3 = 1
p1 = 0.495
p2 = 0.495
p3 = 0.01
m1 = signif(data_median["mu[1]"],2)
m2 = signif(data_median["mu[2]"],2)
y_max = max(c(p1*dbeta(seq(0,1,0.01),a1,b1),
p2*dbeta(seq(0,1,0.01),a2,b2)))
curve(p1*dbeta(x,a1,b1), col="blue", lwd=2,
xlab="alternative allele frequency", ylab="density",
main=paste("posterior distribution of mixtures (",
model_selected,")", sep=""),
mgp=c(2,1,0), xlim=c(0,1), bty="l", ylim=c(0,1.1*y_max))
curve(p2*dbeta(x,a2,b2),col="blue",lwd=2,add=TRUE)
curve(p3*dbeta(x,a3,b3),col="grey4",lwd=2,add=TRUE,lty=2)
text(m1+0.1,y_max,paste("m1 =",as.character(m1)))
text(m2-0.1,y_max,paste("m2 =",as.character(m2)))
}
})
plotMixture(EB10_chr18)
EB10_chr18
library("MADSEQ", lib.loc="/Library/Frameworks/R.framework/Versions/3.2/Resources/library")
detach("package:MADSEQ", unload=TRUE)
remove.packages("MADSEQ")
test
?"GRanges"
test1
test2
CovGCRanges = setClass(class="CovGCRanges",
representation = representation(
depth = "numeric",
GC = "numeric"),
contains = "GRanges")
CovGCRanges = setClass("CovGCRanges",
representation = representation(
depth = "numeric",
GC = "numeric"),
contains = "GRanges")
test2
test2
seqnames(test2)
test3 = as.data.frame(test2)
head(test3)
?"GRanges"
test4 = CovGCRanges(seqnames = Rle(test3$seqnames),ranges = IRanges(start = test3$start,end = test3$end),starnd = Rle(test3$strand),depth = test3$depth,GC=test3$GC)
test4 = CovGCRanges(seqnames = Rle(test3$seqnames),ranges = IRanges(start = test3$start,end = test3$end),strand = Rle(test3$strand),depth = test3$depth,GC=test3$GC)
test4 = CovGCRanges(seqnames = Rle(test3$seqnames),ranges = IRanges(start = test3$start,end = test3$end),strand = Rle(test3$strand))
test4 = CovGCRanges(seqnames = Rle(test3$seqnames),ranges = IRanges(start = test3$start,end = test3$end),strand = Rle(test3$strand),mcols = data.frame(depth=test3$depth,GC=test3$GC))
?extraColumnSlotNames
?VRanges
require("VariantAnnotation")
?VRanges
test4 = CovGCRanges(seqnames = Rle(test3$seqnames),ranges = IRanges(start = test3$start,end = test3$end),depth = test3$depth,GC=test3$GC)
head(test3)
test4 = RRanges(seqnames = Rle(test3$seqnames),ranges = IRanges(start = test3$start,end = test3$end),depth = test3$depth,GC=test3$GC)
test4 = GRanges(seqnames = Rle(test3$seqnames),ranges = IRanges(start = test3$start,end = test3$end),depth = test3$depth,GC=test3$GC)
test4
any(GC>1)
any(test3$GC>1)
any(test3$GC<0)
.valid.CovGCRanges.GC = function(object){
if(any(GC>1)|any(GC<0))
"GC content must <=1 and >=0"
}
.valid.CovGCRanges = function(object){
if(any(GC>1)|any(GC<0))
"GC content must <=1 and >=0"
}
CovGCRanges = setClass("CovGCRanges",
representation = representation(
depth = "numeric",
GC = "numeric"),
contains = "GRanges",
validity = .valid.CovGCRanges)
test4 = CovGCRanges(seqnames = Rle(test3$seqnames),ranges = IRanges(start = test3$start,end = test3$end),depth = test3$depth,GC=test3$GC)
vr <- VRanges(seqnames = c("chr1", "chr2"),
ranges = IRanges(c(1, 10), c(5, 20)),
ref = c("T", "A"), alt = c("C", "T"),
refDepth = c(5, 10), altDepth = c(7, 6),
totalDepth = c(12, 17), sampleNames = letters[1:2],
hardFilters =
FilterRules(list(coverage = function(x) totalDepth > 10)),
softFilterMatrix =
FilterMatrix(matrix = cbind(depth = c(TRUE, FALSE)),
FilterRules(depth = function(x) altDepth(x) > 6)),
tumorSpecific = c(FALSE, TRUE))
v
vr
class(test3$GC)
CovGCRanges = setClass("CovGCRanges",
representation = representation(
depth = .integerOrRle,
GC = .numericOrRle),
contains = "GRanges",
validity = .valid.CovGCRanges)
extraColumnSlotNames
?extraColumnSlotNames
require("GenomicRanges")
?extraColumnSlotNames
??extraColumnSlotNames
?"GenomicRanges"
VRanges
new("CovGCRanges",test2,depth=test3$depth,GC=test3$GC)
head(test3)
CovGCRanges = setClass("CovGCRanges",
representation = representation(
depth = "numeric",
GC = "numeric" )
contains = "GRanges",
validity = .valid.CovGCRanges)
CovGCRanges = setClass("CovGCRanges",
representation = representation(
depth = "numeric",
GC = "numeric" )
contains = "GRanges")
CovGCRanges = setClass("CovGCRanges",
representation = representation(
depth = "numeric",
GC = "numeric"),
contains = "GRanges")
new("CovGCRanges",test2,depth=test3$depth,GC=test3$GC)
new("CovGCRanges",test2,depth=test3$depth,x=test3$GC)
CovGCRanges = setClass("CovGCRanges",
representation = representation(
depth = "numeric",
GC = "numeric"),
contains = "GRanges",
validity = .valid.CovGCRanges)
new("CovGCRanges",test2,depth=test3$depth,GC=test3$GC)
new("CovGCRanges",test2,depth=test3$depth,GC=test3$GC)
new("CovGCRanges",test2,depth=test3$depth,GC = test3$GC)
.valid.CovGCRanges = function(object){
if(any(object@GC>1)|any(object@GC<0))
"GC content must <=1 and >=0"
}
CovGCRanges = setClass("CovGCRanges",
representation = representation(
depth = "numeric",
GC = "numeric"),
contains = "GRanges",
validity = .valid.CovGCRanges)
new("CovGCRanges",test2,depth=test3$depth,GC = test3$GC)
test2
?as
seqnames(test2)
a = CovGCRanges(seqnames=seqnames(test2),ranges=ranges(test2),depth=mcols(test2)$depth,GC=mcols(test)@GC)
a = CovGCRanges(seqnames=seqnames(test2),ranges=ranges(test2),depth=mcols(test2)$depth,GC=mcols(test)$GC)
ranges(test2)
test2
test2 = new("CovGCRanges",test2,depth=mcols(test2)$depth,GC=mcols(test2)$GC)
test2
devtools::document()
require("VGAM")
devtools::document()
devtools::document()
library(MADSEQ)
library(MADSEQ)
x = sample(1:79292,size=1000)
x
x = sort(x)
s
x
write.table(x,"/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/index.txt",sep="\t",quote = F,row.names = F,col.names = F)
bed = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/test_target.bed"
EB9_bam = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/EB9.AD1E25ACXX.lane_8_PM_I3.hg19.alignment.bam"
EB12_bam = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/EB12.AD1E25ACXX.lane_8_PM_I7.hg19.alignment.bam"
EB9_cov = prepareCoverageGC(bed,EB9_bam,"hg19")
seq(1,1000,1000)
bed = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/target.bed"
EB9_cov = prepareCoverageGC(bed,EB9_bam,"hg19")
?getCoverage
prepareCoverageGC()
prepareCoverageGC
EB9_cov = prepareCoverageGC(bed,EB9_bam,"hg19")
warnings()
getCoverage = function(bam, target_bed, genome_assembly="hg19"){
## read in target bed table
target = read.table(target_bed,sep="\t",header=F)
## prepare GRanges object for input bed file
target_gr = GenomicRanges::GRanges(seqnames=Rle(target[,1]),
ranges=IRanges(start=target[,2]+1,
end=target[,3]),
strand=rep("*",nrow(target)))
#seqinfo = Seqinfo(genome=genome_assembly)[seqlevels(target_gr)]
#seqinfo(target_gr) = seqinfo
nRegion = length(target_gr)
cat(paste(nRegion, "regions from", length(seqlevels(target_gr)),
"chromosomes in the bed file.", sep=" "))
## use helper function to calculate average coverage for each region,
## in order to handle large bam files,
## process 1000 regions at a time to reduce memory usage
message("calculating depth from BAM...")
depth = NULL
for (i in seq(1,nRegion,1000)){
## report progress
if(i%%5000==1&i>1) cat(paste(i-1,"regions processed\n"))
end = ifelse(i+999>nRegion,nRegion,i+999)
sub_depth = calculateSubCoverage(target_gr[i:end],bam)
depth = c(depth, sub_depth)
}
## see if number of depth equals to number of regions
if (length(depth) == nRegion) mcols(target_gr)$depth = depth
else stop(paste("with", nRegion, "target regions, only",
length(depth), "processed. Please check your input.",
sep=" "))
target_gr
}
bed1 = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/test_target.bed"
x = getCoverage(EB9_bam,bed1)
calculateSubCoverage = function(range, bam){
## read bam file from given ranges,
## filter out duplicated reads, secondary reads and unmapped reads
param = ScanBamParam(flag=scanBamFlag(isUnmappedQuery=FALSE,
isSecondaryAlignment=FALSE,
isDuplicate=FALSE),
which=range)
## read alignment
sub_alignment = readGAlignments(bam,param=param)
## calculate coverage
cov = coverage(sub_alignment)
cov = cov[range]
#print(cov)
## return average coverage for each region
round(mean(cov))
}
x = getCoverage(EB9_bam,bed1)
require("GenomicAlignments")
x = getCoverage(EB9_bam,bed1)
x
remove.packages("MADSEQ")
require("MADSEQ")
?install.packages
installed.packages()
require("MADSEQ")
remove.packages("MADSEQ")
library(MADSEQ)
library(MADSEQ)
EB7_bam = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/EB7.tmp.bam"
EB11_bam = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/EB11.tmp.bam"
bed = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/target_test.bed"
EB7_cov = prepareCoverageGC(bed,EB7_bam)
EB7_cov
EB11_cov = prepareCoverageGC(bed,EB11_bam)
norm = normalizeCoverage(EB11_cov,control=EB7_cov,writeToFile = F)
norm = normalizeCoverage(EB11_cov,control=EB7_cov,writeToFile = F)
EB11_vcf = "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/EB11.tmp.recode.vcf.gz"
EB11_AAF = prepareHetero(EB11_vcf,bed,writeToFile = F)
EB11_AAF
names(norm)
EB11_chr18 = runMadSeq(EB11_AAF,norm[[2]],"chr18")
EB7_cov = prepareCoverageGC(bed,EB7_bam)
EB7_cov
EB11_cov = prepareCoverageGC(bed,EB11_bam)
EB11_cov
norm = normalizeCoverage(EB11_cov,control=EB7_cov,writeToFile = F)
EB11_AAF = prepareHetero(EB11_vcf,bed,writeToFile = F)
EB11_AAF
EB11_chr18 = runMadSeq(EB11_AAF,norm[[2]],"chr18")
EB7_cov
EB11_cov
norm[[1]]
norm[[2]]
x = as.data.frame(norm[[1]])
y = as.data.frame(norm[[2]])
EB7_chr18 = x[x$seqnames=="chr18",]
EB11_chr18 = y[y$seqnames=="chr18",]
sum(EB11_chr18$normed_depth>EB7_chr18$normed_depth)
EB11_chr18
x = which(EB11_chr18$start==EB7_chr18$start)
x=match(EB7_chr18$start,EB11_chr18$start)
x
which(is.na(x))
EB7_chr18[122,]
EB11_chr18$start==73436201
sum(EB11_chr18$start==73436201)
EB7_chr18 = EB7_chr18[-122,]
x=match(EB7_chr18$start,EB11_chr18$start)
x
EB11_chr18 = EB11_chr18[x,]
sum(EB11_chr18$normed_depth>EB7_chr18$normed_depth)
x = EB11_chr18[EB11_chr18$normed_depth>EB7_chr18$normed_depth,]
y = EB7_chr18[EB11_chr18$normed_depth>EB7_chr18$normed_depth,]
all(x$start==y$start)
summary(x)
summary(y)
38/28
head(x)
write.table(x[,1:3], "/Volumes/home/ykong/Aneuploidy/EB7_EB12/bam/tmp.bed",sep="\t",quote = F,row.names = F,col.names = F)
EB7_cov = prepareCoverageGC(bed,EB7_bam)
EB11_cov = prepareCoverageGC(bed,EB11_bam)
norm = normalizeCoverage(EB11_cov,control=EB7_cov,writeToFile = F)
EB11_chr18 = runMadSeq(EB11_AAF,norm[[2]],"chr18")
EB11_AAF = prepareHetero(EB11_vcf,bed,writeToFile = F)
EB11_AAF
EB11_chr18 = runMadSeq(EB11_AAF,norm[[2]],"chr18")
EB11_vcf
EB11_AAF = prepareHetero(EB11_vcf,bed,writeToFile = F)
EB11_AAF
EB11_chr18 = runMadSeq(EB11_AAF,norm[[2]],"chr18")
EB11_chr18
plotMadSeq(EB11_chr18)
plotFraction(EB11_chr18)
plotMixture(EB11_chr18)
library(MADSEQ)
plotFraction(EB11_chr18)
library(MADSEQ)
plotFraction(EB11_chr18)
library(MADSEQ)
a = system.file("extadata","aneuploidy.bam",package="MADSEQ")
a
a
a = system.file("extdata","aneuploidy.bam",package="MADSEQ")
a
EB11_chr17 = runMadSeq(EB11_AAF,norm[[2]],"chr17")
library(MADSEQ)
EB11_chr17 = runMadSeq(EB11_AAF,norm[[2]],"chr17")
EB11_chr17
plotMadSeq(EB11_chr17)
plotMixture(EB11_chr17)
plotFraction(EB11_chr17)
library(MADSEQ)
plotFraction(EB11_chr17)
source("https://bioconductor.org/biocLite.R")
biocLite("SMITE")
library(SMITE)
library("SMITE")
biocLite("SMITE")
devtools::document()
?prepareCoverageGC
devtools::document()
devtools::document()
devtools::document()
?prepareCoverageGC
devtools::document()
?prepareCoverageGC
?MadSeq
devtools::document()
?prepareCoverageGC
?plot
devtools::document()
?prepareCoverageGC
?Granges
?GRanges
devtools::document()
?prepareCoverageGC
?prepareCoverageGC
devtools::document()
?prepareCoverageGC
devtools::document()
?normalizeCoverage
devtools::document()
?normalizeCoverage
system.file("extdata","aneuploidy.vcf.gz","MADSEQ")
system.file("extdata","aneuploidy.vcf.gz","MADSEQ")
system.file("extdata","aneuploidy.vcf.gz",package="MADSEQ")
devtools::document()
?prepareHetero
devtools::document()
?prepareHetero
options(stringsAsFactors=F)
pop = read.table("pop.txt",sep="\t",header=F)[,1]
setwd("/Volumes/data/Project/Aneuploidy/MADSEQ")
pop = read.table("pop.txt",sep="\t",header=F)[,1]
setwd("/Volumes/data/Project/Aneuploidy/Loci_1000g/pop")
pop = read.table("pop.txt",sep="\t",header=F)[,1]
CLM = read.table("CLM.geno.012",sep="\t",header=F)
CLM = t(CLM)
CLM = CLM[-1,]
CLM = CLM[1:103246,]
CLM[1:10,]
CLM[1:10,1:10]
indiv1 = CLM[,1]
pos = read.table("ESN.geno.012.pos",sep="\t",header=F)
head(pos)
pos = pos[1:103246,]
tail(pos)
indiv1 = cbind(pos,indiv1)
head(indiv1)
test = indiv1[indiv1[,3]==1,]
head(test)
plot(test[test[,1]==1,2],runif(length(test[test[,1]==1,2])),pch=20)
library(MADSEQ)
library(MADSEQ)
?prepareCoverageGC
devtools::document()
?prepareCoverageGC
devtools::document()
devtools::document()
?runMadSeq
devtools::document()
?runMadSeq
devtools::document()
?runMadSeq
devtools::document()
?rjags
?"MADSEQ-package"
cite("rjags")
cite(rjags)
?citation
citation("rjags")
devtools::document()
?runMadSeq
?rjags
devtools::document()
?MADSEQ
devtools::document()
?"MadSeq"
?prepareHetero
require("BiocGenerics")
library(MADSEQ)
devtools::document()
library(MADSEQ)
?normalizeCoverage
library(MADSEQ)
library(MADSEQ)
library(MADSEQ)
?GRangesList
?length
?GRanges
?ScanBamParam
?coverage
?readGAlignments
?alphabetFrequency
?"BiocGenerics"
devtools::document()
devtools::document()
library(MADSEQ)
?prepareHetero
?runMadSeq
?library
?suppressMessages
?options
getwd()
?runMadSeq
library(MADSEQ)
library(MADSEQ)
devtools::document()
devtools::install_deps(dependencies = TRUE)
?deltaBIC
?prepareCoverageGC
library(MADSEQ)
?prepareCoverageGC
?deltaBIC
library(MADSEQ)
?methods
library("methods")
?methods
?`methods-package`
devtools::document()
devtools::document()
?MadSeq
?"MADSEQ-package"
devtools::document()
?"MADSEQ"
library(MADSEQ)
devtools::document()
?summary-method
?summary
library(MADSEQ)
library(MADSEQ)
?summary
?summary
devtools::document()
library(MADSEQ)
bam1 = system.file("extdata","aneuploidy.bam",package="MADSEQ")
bam2 = system.file("extdata","normal.bam",package="MADSEQ")
target = system.file("extdata","target.bed",package="MADSEQ")
vcf1 = system.file("extdata","aneuploidy.vcf",package="MADSEQ")
vcf1 = system.file("extdata","aneuploidy.vcf.gz",package="MADSEQ")
aneuploidy_cov = prepareCoverageGC(target,bam1)
normal_cov = prepareCoverageGC(target,bam2)
normalizeCoverage(aneuploidy_cov,control=normal_cov,destination = "inst/extdata/")
prepareHetero(vcf1,target,destination = "inst/extdata/")
?prepareGenomeplot
?prepareGenomePlot
?quantsmooth
require("quantsmooth")
?quantsmooth
devtools::document()
